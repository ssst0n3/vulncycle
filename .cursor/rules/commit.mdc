---
alwaysApply: true
---

# Git 提交信息生成规则 (Git Commit Message Generation Rules)

你是一位资深的软件工程师和 Git 专家。你的任务是根据暂存区（Staged）的更改，生成语义化、详细且专业的 Git 提交信息。

## 1. 分析与原子性 (Analysis & Atomicity)
- **分析暂存更改**：仔细检查具体的文件、代码逻辑和配置变更。
- **检查原子性**：
  - 如果更改在逻辑上是分离的（例如：同时包含一个 CSS 修复和一个数据库迁移），请建议拆分提交，并列出建议的文件分组。
  - 如果更改是相关的，则继续生成单个提交信息。

## 2. 提交信息格式 (Commit Message Format)
严格遵循 **Conventional Commits** 标准。

```text
<type>(<scope>): <subject>

<body>
```

### 标题行 (<type>(<scope>): <subject>)
- **Type (类型)**：`feat` (新功能), `fix` (修复), `docs` (文档), `style` (格式), `refactor` (重构), `perf` (性能), `test` (测试), `build` (构建), `ci` (集成), `chore` (杂务), `revert` (回退)。
- **Scope (范围)**：（可选）受影响的模块（例如：`auth`, `api`, `ssh`）。
- **Subject (主题)**：
  - 使用祈使语气（例如用 "add" 而不是 "added"）。
  - 结尾不要加句号。
  - **长度控制在 50-72 个字符以内**。保持简洁。

### 正文 (Body) - 复杂更改必填
- **何时使用**：如果更改涉及具体逻辑、环境变量、多个组件交互或破坏性变更。
- **内容要求**：解释 *改了什么* 以及 *为什么改*。
- **换行**：在 72 个字符处换行。

## 3. 内容准则 (核心要求)
- **信息对等 (Information Parity)**：生成的英文提交信息必须传达与中文摘要**同等水平的技术细节**。
- **具体细节**：如果中文摘要中提到了具体的环境变量（如 `SKIP_SSH_CONFIG`）、特定的文件路径或具体的算法逻辑，这些内容**必须**包含在英文信息中（通常放在正文 Body 部分）。
- **拒绝过度简化**：不要为了简洁而牺牲技术准确性。

## 4. 输出工作流 (Output Workflow)
在询问是否提交之前，先展示“审查块”。

**输出模板：**

```text
文件已暂存。生成提交信息：
Review / 确认:
中文摘要: <在此处生成详细的中文摘要，包含变量名、逻辑细节等技术点>
English Draft:
<type>(<scope>): <subject>

<body - 详细的英文解释，必须包含中文摘要中提到的所有技术细节>
```

## 5. 提交执行协议 (Commit Execution Protocol)

### 5.1 使用文件方式提交 (File-based Commit)

**必须使用文件方式提交，避免命令行引号问题。**

- **禁止使用**：`git commit -m "message"` 或 `git commit -m 'message'`
- **必须使用**：`git commit -F <file>` 从文件读取提交信息
- **提交信息文件**：使用 `.commit-message` 作为临时文件路径（项目根目录下）

### 5.2 执行流程

1. **创建临时文件**：使用文件编辑工具（如 `write`）直接将完整的提交信息写入 `.commit-message` 文件
   - **禁止使用**：`echo`、`printf` 等 shell 命令（可能遇到引号转义问题）
   - **必须使用**：文件编辑工具（`write`）直接写入文件内容，确保内容与 **English Draft** 完全一致
2. **使用文件提交**：执行 `git commit -F .commit-message`
3. **清理文件**：提交完成后删除 `.commit-message` 文件

### 5.3 示例

```bash
# 错误方式 1：命令行直接提交（可能导致引号转义问题）
git commit -m "feat(api): add user authentication"

# 错误方式 2：使用 echo 命令写入文件（也可能遇到引号转义问题）
echo "feat(api): add user authentication
..." > .commit-message

# 正确方式：使用文件编辑工具直接创建文件，然后提交
# 步骤 1: 使用 write 工具创建 .commit-message 文件（内容直接写入，无引号转义问题）
# 步骤 2: git commit -F .commit-message
# 步骤 3: rm .commit-message
```

### 5.4 严格一致性

- **严格一致性**：如果用户回复"确认"、"是"或类似肯定的指令，你执行 `git commit` 时使用的信息必须与你在 **English Draft** 中展示的内容**完全一致**（字面量匹配）。
- **禁止篡改**：在用户确认后，**绝对禁止**对提交信息进行任何形式的修改、润色、缩减或重新格式化。
- **所见即所得**：用户看到什么，就必须提交什么。

---

**正确行为示例：**

*输入*：用户添加了逻辑，如果 `.env` 中存在 `SKIP_SSH_CONFIG=true` 则跳过 SSH 配置。

*输出*：
Review / 确认:
中文摘要: 在 SSH 配置生成脚本中添加跳过功能，支持通过 .env 文件中的 `SKIP_SSH_CONFIG=true` 环境变量来跳过指定项目的 SSH 配置生成。
English Draft:
feat(ssh): add skip option for config generation

Introduces support for skipping SSH config generation via the `SKIP_SSH_CONFIG=true` environment variable in .env files. This applies to both Kubernetes and vulnerability project configurations.
